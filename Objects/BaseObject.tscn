[gd_scene load_steps=5 format=2]

[ext_resource path="res://icon.png" type="Texture" id=1]
[ext_resource path="res://Objects/BaseActivator.gd" type="Script" id=2]

[sub_resource type="GDScript" id=2]
script/source = "extends Area2D

onready var interaction_point = get_parent().get_node(\"InteractionPoint\")
onready var activator = get_parent().get_node(\"Activator\")
onready var cursor_manager = get_node(\"/root/MouseCursorManager\")
onready var floatie = get_node(\"/root/Floatie\")
onready var mode_controller = get_node(\"/root/ModeController\")

export var ActivatorName : String = \"Unnamed\"
export(String, \"From interaction point\", \"Remote\", \"Background\") var activation_type

func _input_event(viewport, event, shape_idx):
	if mode_controller.mode != mode_controller.GameMode.WORLDSPACE:
		return
	if not event is InputEventMouseButton:
		return
	if event.button_index != BUTTON_LEFT or not event.pressed:
		return
	if cursor_manager.is_mouse_active == false:
		return
	print(\"Clicked %s\" % ActivatorName) 
	
	if activator == null:
		printerr(\"No activator set for %s\" % ActivatorName)
		return
	
	var player = get_tree().get_nodes_in_group(\"player\")
	if player.size() == 0:
		# player not active
		return
	else:
		player = player[0]
	
	match activation_type:
		\"From interaction point\":
			if interaction_point == null:
				printerr(\"No interaction point for %s\" % ActivatorName)
				return
			player.freeze()
			if interaction_point.global_position.distance_to(player.position) < 0.01:
				activator.activate()
			else:
				print(\"Activator:\")
				print(activator)
				player.set_activation_intent(activator)
				player.initialize_movement(interaction_point.global_position)
		\"Remote\":
			player.freeze()
			activator.activate()
		\"Background\":
			activator.activate()
		_:
			printerr (\"Incorrect activation type for %s: %s\" % [ActivatorName, activation_type])

func _on_ClickArea_mouse_entered():
	if mode_controller.mode != mode_controller.GameMode.WORLDSPACE:
		return
	if get_node(\"/root/DialogueWindow\").is_up():
		return
	if cursor_manager.is_mouse_active:
		cursor_manager.hand_cursor()
		floatie.display(ActivatorName)


func _on_ClickArea_mouse_exited():
	if mode_controller.mode != mode_controller.GameMode.WORLDSPACE:
		return
	if get_node(\"/root/DialogueWindow\").is_up():
		return
	cursor_manager.base_cursor()
	floatie.stop_displaying()
"

[sub_resource type="RectangleShape2D" id=3]
extents = Vector2( 14.2098, 14.7522 )

[node name="BaseObject" type="Node2D"]

[node name="Sprite" type="Sprite" parent="."]
position = Vector2( -0.88578, -15.4263 )
scale = Vector2( 0.458824, 0.473206 )
texture = ExtResource( 1 )

[node name="InteractionPoint" type="Position2D" parent="."]
position = Vector2( 0, 20 )

[node name="ClickArea" type="Area2D" parent="."]
script = SubResource( 2 )
activation_type = "From interaction point"

[node name="CollisionShape2D" type="CollisionShape2D" parent="ClickArea"]
position = Vector2( -0.611725, -15.3016 )
shape = SubResource( 3 )

[node name="Activator" type="Node" parent="."]
script = ExtResource( 2 )
[connection signal="mouse_entered" from="ClickArea" to="ClickArea" method="_on_ClickArea_mouse_entered"]
[connection signal="mouse_exited" from="ClickArea" to="ClickArea" method="_on_ClickArea_mouse_exited"]
