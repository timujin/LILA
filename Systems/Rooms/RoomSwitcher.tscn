[gd_scene load_steps=2 format=2]

[sub_resource type="GDScript" id=1]
script/source = "extends Node

signal new_room_loaded

signal deserialize_complete
var room_deserialized setget set_room_deserialized

func r(id:String):
	return GlobalRegister.room(id)
	
class DeserializeNotifierComplete:
	signal deserialize_complete
	func run():
		emit_signal(\"deserialize_complete\")
		return self
	
var notifier setget , get_notifier

func get_notifier():
	if notifier == null:
		notifier = DeserializeNotifierComplete.new()
	notifier.call_deferred(\"run\")
	return notifier

#####################
## ROOM LOADING #####
#####################

func set_room_deserialized(value):
	room_deserialized = value
	if value:
		emit_signal(\"deserialize_complete\")
		notifier.run()

var room:Node = null
	
func switch_room_obj(to_room):
	room_deserialized = false
	ModeController.reset()
	$\"/root/Room\".pickle()
	$\"/root/Room\".serialize()
	$\"/root/Room\".name = \"Todelete_room\"
	$\"/root/Todelete_room\".queue_free()
	room = to_room.instance()
	get_tree().get_root().add_child(room)

func switch_to(id:String):
	#Character.variables.set_value(\"attempted_load_room\", id)
	var roomscene = r(id)
	if roomscene == null:
		printerr(\"!!! Room not found!: \" + id)
		assert(false)
		#DeveloperConsole.echo(\"!!! Room not found!: \" + id)
		pass
	else:
		switch_room_obj(roomscene)
"

[node name="RoomSwitcher" type="Node"]
script = SubResource( 1 )
