[gd_scene load_steps=30 format=2]

[ext_resource path="res://Content/Rooms/FFFFFTestinghall/PlainCubeRoom/PlainCubeRoom.tscn" type="PackedScene" id=1]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/PlainWhiteDoor.png" type="Texture" id=2]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/WC.png" type="Texture" id=3]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/MagazinesBW.png" type="Texture" id=4]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/MagazinesDada.png" type="Texture" id=5]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/SmallTable.png" type="Texture" id=6]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/BowlEmpty.png" type="Texture" id=7]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/Bowl.png" type="Texture" id=8]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/Sofa.png" type="Texture" id=9]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/LongTable.png" type="Texture" id=10]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/Magazines.png" type="Texture" id=11]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/Window.png" type="Texture" id=12]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/Aquarium.png" type="Texture" id=13]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/SpiritSillhouette.png" type="Texture" id=14]
[ext_resource path="res://Systems/Interactables/BaseInteractable.tscn" type="PackedScene" id=15]
[ext_resource path="res://Systems/Rooms/BasePickler.gd" type="Script" id=16]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/WallclockDali.png" type="Texture" id=17]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/AquariumDada.png" type="Texture" id=18]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/Wallclock.png" type="Texture" id=19]
[ext_resource path="res://Content/Rooms/00000Tutorial/WaitingRoom/Graphics/BowlGrey.png" type="Texture" id=20]
[ext_resource path="res://Assets/Themes/HUD.tres" type="Theme" id=21]

[sub_resource type="GDScript" id=1]
script/source = "extends Node


func on_activate():
	RoomSwitcher.switch_to(\"00000WaitingRoomWC\")
"

[sub_resource type="SpriteFrames" id=2]
animations = [ {
"frames": [ ExtResource( 19 ), ExtResource( 17 ) ],
"loop": true,
"name": "default",
"speed": 5.0
} ]

[sub_resource type="GDScript" id=3]
script/source = "extends Node

enum MagazineStates {BLACKWHITE=0, COLORED=1, DADA=2}
export(MagazineStates) var state setget set_magazine_state

func set_magazine_state(value):
	state = value
	call_deferred(\"update_rendering\")
		
func update_rendering():
	$BWMagazines.visible = false
	$ColoredMagazines.visible = false
	$DadaMagazines.visible = false
	if state == MagazineStates.BLACKWHITE:
		$BWMagazines.visible = true
	elif state == MagazineStates.COLORED:
		$ColoredMagazines.visible = true
	elif state == MagazineStates.DADA:
		$DadaMagazines.visible = true
	$\"Pickler\".update(\"MagazineAppearance\", state)
			
func _ready():
	update_rendering()


func _on_Pickler_unpickled(data):
	set_magazine_state(data[\"MagazineAppearance\"])


func _on_Clickable_on_activate():
	if state == 0:
		set_magazine_state(1)
	elif state == 1:
		set_magazine_state(2)
	elif state == 2:
		set_magazine_state(0)
"

[sub_resource type="SpriteFrames" id=4]
animations = [ {
"frames": [ ExtResource( 8 ), ExtResource( 7 ), ExtResource( 20 ) ],
"loop": true,
"name": "default",
"speed": 5.0
} ]

[sub_resource type="GDScript" id=5]
script/source = "extends Node

\"\"\"
Some initial exposition.
The game becomes fully interactive after that.
\"\"\"

func _ready():
	DeveloperConsole.connect(\"skip_cutscene\", self, \"skip\")

var expecting = false

func _on_Pickler_unpickled(data):
	if data[\"first_time\"]:
		$Pickler.update(\"first_time\", false)
		yield($Modal/Panel, \"clicked\")
		ModeController.start_interaction()
		$Hello.execute()
		if $Modal != null: $Modal.queue_free()
	else:
		if $Modal != null: $Modal.queue_free()
		

func skip():
	if $Modal != null: $Modal.queue_free()
	$Hello.skip()
"

[sub_resource type="GDScript" id=6]
script/source = "extends CutsceneEngine

signal cont

onready var thought = null

var nagging_thought_added = false

func _ready():
	pass
	#DeveloperConsole.connect(\"skip_cutscene\", self, \"skip\")

func execute(sequence = \"start_sequence\"):
	thought = Character.inventory.add_item_by_id(\"NaggingThought\").icon
	nagging_thought_added = true
	start_sequence()
	
func signal_cont():
	emit_signal(\"cont\")

func skip():
	if not nagging_thought_added:
		Character.inventory.add_item_by_id(\"NaggingThought\")
	self.end_cutscene()

func start_sequence():
	clear_player_choices()
	choice_call(\"Continue...\", \"signal_cont\")
	shl(\"This is the waiting room.\");yield(self, \"cont\")
	shl(\"I'm sitting in it, surrounded by beige wallpaper, submersed into the drone of an air conditioner.\");yield(self, \"cont\")
	shl(\"Under me is a sofa, my back glued onto the synthetic leather by a layer of drying sweat.\");yield(self, \"cont\")
	shl(\"I've been here forever. The moments of the past stretch endlessly back in my head.\");yield(self, \"cont\")
	shl(\"My memories converge onto an infinitely-away singularity, like onto a temporal vanishing point.\");yield(self, \"cont\")
	shl(\"There is nothing else.\");yield(self, \"cont\")
	shl(\"Nothing ever happens here, in the waiting room. I will just sit here until things start happening elsewhere.\");yield(self, \"cont\")
	shl(\"This is what \\\"waiting\\\" means.\");yield(self, \"cont\")
	shl(\"I'm just sitting.\");yield(self, \"cont\")
	shl(\"But then, once per eternity, just like a spontaneous bubble of order arises amidst an \"+\\
		\"endless sea of chaos, by a fluke, a thought rises to my attention.\");yield(self, \"cont\")
	sh(thought,\"\\\"What are you waiting for?\\\" the thought asks.\");yield(self, \"cont\")
	sh(thought,\"\\\"Is that ever going to come?\\\"\");yield(self, \"cont\")
	sh(thought,\"\\\"You've been here forever, and nothing happened. Why do you think it'll happen in the next forever?\\\"\")
	clear_player_choices()
	choice_call(\"\\\"I'm waiting for the door to open.\\\"\", \"seq_door_open\")
	choice_call(\"\\\"I'm waiting for the world to end.\\\"\", \"\").\\
		set_enabled(false).\\
		add_req_icon(preload(\"res://Assets/Sprites/Icons/No.png\"), false).\\
		set_req_text(\"Not implemented!\")
	choice_call(\"\\\"I'm just sitting.\\\"\", \"seq_sitting\").\\
		set_enabled(false).\\
		add_req_icon(preload(\"res://Assets/Sprites/Icons/No.png\"), false).\\
		set_req_text(\"Not implemented!\")
	
func seq_door_open():
	clear_player_choices()
	choice_call(\"Continue...\", \"signal_cont\")
	shl(\"'I'm waiting for the door to open.', I reply, 'The door is the only way out of the Waiting Room.'\");yield(self, \"cont\")
	sh(thought,\"'And what do you expect to find behind it?' the thought asks, 'What exactly are you waiting for, Spirit?'\");yield(self, \"cont\")
	shl(\"I give it a moment of thought. 'Sweet oblivion, I guess. An endless, eternal void where nothing happens. That sounds very attractive to me right now.'\");yield(self, \"cont\")
	sh(thought,\"'How do you know you're not already in oblivion, Spirit? Nothing happens here, either.\");yield(self, \"cont\")
	shl(\"'But I'm still here. I think, therefore, I am. I think.'\");yield(self, \"cont\")
	sh(thought, \"'Oh, well, that's a nice attempt at deduction. But it's not that simple.'\");yield(self, \"cont\")
	sh(thought, \"'In fact, it's the other way around. You are in oblivion right now, and behind the door is the real world'\");yield(self, \"cont\")
	sh(thought, \"'Don't worry, though! You'll learn more about the nature of reality as you go'\");yield(self, \"cont\")
	sh(thought, \"'But right now you should really focus on *not* falling into eternal oblivion.'\");yield(self, \"cont\")
	sh(thought, \"'As you sit here, in this goddess-forsaken hovel, you are disappearing. You were never particularly real anyway, and\"+\\
				\" being unnoticed by the reality doesn't help'.\");yield(self, \"cont\")
	sh(thought, \"'You need to *get out of here*. This room is where ideas go to die. You are an idea, Spirit. Please don't die.\");yield(self, \"cont\")
	sh(thought, \"[[Some exposition and an opportunity for the PC to show off his attitude.]]\")
	clear_player_choices()
	choice_call(\"OK\", \"end_cutscene\")
	
"

[sub_resource type="GDScript" id=7]
script/source = "extends Panel

signal clicked

func _gui_input(event):
	if event.is_action_pressed(\"dismiss\"):
		emit_signal(\"clicked\")
"

[sub_resource type="Animation" id=8]
tracks/0/type = "value"
tracks/0/path = NodePath(".:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 1 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Color( 0, 0, 0, 1 ), Color( 0, 0, 0, 0 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath(".:visible")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PoolRealArray( 0, 1 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 1,
"values": [ true, true ]
}

[node name="Room" instance=ExtResource( 1 )]
roomName = "Waiting room"
roomID = "00000WaitingRoom"

[node name="DoorOut" type="Sprite" parent="Cube" index="0"]
position = Vector2( -298.87, -241.352 )
scale = Vector2( 1.22336, 1.24549 )
texture = ExtResource( 2 )

[node name="WCDoor" parent="Cube" index="1" instance=ExtResource( 15 )]

[node name="BlurbPoint" parent="Cube/WCDoor" index="0"]
position = Vector2( 495.059, -167.22 )

[node name="Activator" parent="Cube/WCDoor" index="1"]
script = SubResource( 1 )

[node name="Clickable" parent="Cube/WCDoor" index="2"]
ActivatorName = "WC door"

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Cube/WCDoor/Clickable" index="0"]
visible = false
polygon = PoolVector2Array( 690.72, -246.704, 869.485, -166.686, 871.187, 189.141, 687.315, 104.015 )

[node name="PlainWhiteDoor" type="Sprite" parent="Cube/WCDoor" index="3"]
position = Vector2( 780.086, -29.1525 )
scale = Vector2( 1.24314, 1.24314 )
texture = ExtResource( 2 )
flip_h = true

[node name="WC" type="Sprite" parent="Cube/WCDoor/PlainWhiteDoor" index="0"]
position = Vector2( 3.67969, -55.9641 )
scale = Vector2( 1.36953, 1.36953 )
texture = ExtResource( 3 )

[node name="Wallclock" parent="Cube" index="2" instance=ExtResource( 15 )]

[node name="Wallclock" type="AnimatedSprite" parent="Cube/Wallclock" index="3"]
position = Vector2( 235.942, -495.651 )
frames = SubResource( 2 )

[node name="LongTable" type="Sprite" parent="Cube" index="3"]
position = Vector2( -6.24988, -197.456 )
scale = Vector2( 1.41208, 1.41208 )
texture = ExtResource( 10 )

[node name="Magazines" type="Node" parent="Cube/LongTable" index="0"]
script = SubResource( 3 )

[node name="BWMagazines" type="Sprite" parent="Cube/LongTable/Magazines" index="0"]
position = Vector2( -12.9642, -137.497 )
scale = Vector2( 0.957893, 0.957893 )
texture = ExtResource( 4 )

[node name="ColoredMagazines" type="Sprite" parent="Cube/LongTable/Magazines" index="1"]
visible = false
position = Vector2( -12.9642, -137.497 )
scale = Vector2( 0.957893, 0.957893 )
texture = ExtResource( 11 )

[node name="DadaMagazines" type="Sprite" parent="Cube/LongTable/Magazines" index="2"]
visible = false
position = Vector2( -12.9642, -137.497 )
scale = Vector2( 0.957893, 0.957893 )
texture = ExtResource( 5 )

[node name="Pickler" type="Node" parent="Cube/LongTable/Magazines" index="3"]
script = ExtResource( 16 )
data = {
"MagazineAppearance": 0
}

[node name="Clicker" parent="Cube/LongTable/Magazines" index="4" instance=ExtResource( 15 )]

[node name="BlurbPoint" parent="Cube/LongTable/Magazines/Clicker" index="0"]
position = Vector2( 6.02942, -221.58 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Cube/LongTable/Magazines/Clicker/Clickable" index="0"]
visible = false
polygon = PoolVector2Array( 9.98276, -176.445, -85.1852, -131.067, -66.2777, -91.9918, 45.9071, -140.521, 58.5121, -150.605 )

[node name="Sofa" type="Sprite" parent="Cube" index="4"]
position = Vector2( 262.89, 368.334 )
scale = Vector2( 1.13321, 1.13321 )
texture = ExtResource( 9 )

[node name="SpiritSillhouette" type="Sprite" parent="Cube/Sofa" index="0"]
position = Vector2( -28.2094, -73.3492 )
scale = Vector2( 1.50238, 1.50238 )
texture = ExtResource( 14 )

[node name="SmallTable" type="Sprite" parent="Cube" index="5"]
position = Vector2( -18.6402, 502.784 )
scale = Vector2( 1.22336, 1.24549 )
texture = ExtResource( 6 )

[node name="CandyBowl" type="Node2D" parent="Cube/SmallTable" index="0"]

[node name="1" type="AnimatedSprite" parent="Cube/SmallTable/CandyBowl" index="0"]
position = Vector2( 2.70496, -64.12 )
scale = Vector2( 1.36246, 1.33826 )
frames = SubResource( 4 )
frame = 2

[node name="Window" parent="Cube" index="6" instance=ExtResource( 15 )]

[node name="Window" type="Sprite" parent="Cube/Window" index="3"]
modulate = Color( 1, 1, 1, 0.388235 )
position = Vector2( -612.714, 7.77765 )
scale = Vector2( 1.70251, 1.70251 )
texture = ExtResource( 12 )

[node name="Aquarium" type="Sprite" parent="Cube" index="7"]
position = Vector2( 424.013, -42.8869 )
scale = Vector2( 0.971875, 0.971875 )
texture = ExtResource( 13 )

[node name="AquariumDada" type="Sprite" parent="Cube/Aquarium" index="0"]
visible = false
position = Vector2( -5.03009, -1.16069 )
scale = Vector2( 1.75178, 1.75178 )
texture = ExtResource( 18 )

[node name="Label" type="Label" parent="Cube" index="8"]
visible = false
margin_left = -673.0
margin_top = -398.0
margin_right = -458.0
margin_bottom = -255.0
theme = ExtResource( 21 )
text = "Air conditioner"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="StartingCutscene" type="Node" parent="." index="5"]
script = SubResource( 5 )

[node name="Pickler" type="Node" parent="StartingCutscene" index="0"]
script = ExtResource( 16 )
data = {
"first_time": true
}

[node name="Hello" type="Node" parent="StartingCutscene" index="1"]
script = SubResource( 6 )

[node name="Modal" type="CanvasLayer" parent="StartingCutscene" index="2"]

[node name="Panel" type="Panel" parent="StartingCutscene/Modal" index="0"]
modulate = Color( 0, 0, 0, 0 )
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = -1130.73
margin_top = -576.935
margin_right = 83.2742
margin_bottom = 197.065
script = SubResource( 7 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="AnimationPlayer" type="AnimationPlayer" parent="StartingCutscene/Modal/Panel" index="0"]
autoplay = "New Anim"
"anims/New Anim" = SubResource( 8 )
[connection signal="unpickled" from="Cube/LongTable/Magazines/Pickler" to="Cube/LongTable/Magazines" method="_on_Pickler_unpickled"]
[connection signal="on_activate" from="Cube/LongTable/Magazines/Clicker/Clickable" to="Cube/LongTable/Magazines" method="_on_Clickable_on_activate"]
[connection signal="unpickled" from="StartingCutscene/Pickler" to="StartingCutscene" method="_on_Pickler_unpickled"]
[connection signal="cont" from="StartingCutscene/Hello" to="StartingCutscene/Hello" method="_on_Hello_cont"]
[connection signal="clicked" from="StartingCutscene/Modal/Panel" to="StartingCutscene" method="_on_Panel_clicked"]

[editable path="Cube/WCDoor"]

[editable path="Cube/Wallclock"]

[editable path="Cube/LongTable/Magazines/Clicker"]

[editable path="Cube/Window"]
